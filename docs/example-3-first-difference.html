<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12.3 Example 3: First difference | Applied Network Science with R</title>
  <meta name="description" content="An improvised book on applied Network Science with R." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="12.3 Example 3: First difference | Applied Network Science with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An improvised book on applied Network Science with R." />
  <meta name="github-repo" content="gvegayon/appliedsnar" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12.3 Example 3: First difference | Applied Network Science with R" />
  
  <meta name="twitter:description" content="An improvised book on applied Network Science with R." />
  

<meta name="author" content="George G. Vega Yon, Ph.D." />


<meta name="date" content="2022-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="example-2-spillover-effects-pre-post-effect.html"/>
<link rel="next" href="bayes-rule.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-40608305-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-40608305-4');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Network Science with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="part"><span><b>I Applications</b></span></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>3</b> R Basics</a><ul>
<li class="chapter" data-level="3.1" data-path="what-is-r.html"><a href="what-is-r.html"><i class="fa fa-check"></i><b>3.1</b> What is R</a></li>
<li class="chapter" data-level="3.2" data-path="how-to-install-packages.html"><a href="how-to-install-packages.html"><i class="fa fa-check"></i><b>3.2</b> How to install packages</a></li>
<li class="chapter" data-level="3.3" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>3.3</b> Prerequisites</a></li>
<li class="chapter" data-level="3.4" data-path="a-gentle-quick-n-dirty-introduction-to-r.html"><a href="a-gentle-quick-n-dirty-introduction-to-r.html"><i class="fa fa-check"></i><b>3.4</b> A <del>gentle</del> Quick n’ Dirty Introduction to R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="network-nomination-data.html"><a href="network-nomination-data.html"><i class="fa fa-check"></i><b>4</b> Network Nomination Data</a><ul>
<li class="chapter" data-level="4.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html"><i class="fa fa-check"></i><b>4.1</b> Data preprocessing</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#reading-the-data-into-r"><i class="fa fa-check"></i><b>4.1.1</b> Reading the data into R</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-preprocessing.html"><a href="data-preprocessing.html#creating-a-unique-id-for-each-participant"><i class="fa fa-check"></i><b>4.1.2</b> Creating a unique id for each participant</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="creating-a-network.html"><a href="creating-a-network.html"><i class="fa fa-check"></i><b>4.2</b> Creating a network</a><ul>
<li class="chapter" data-level="4.2.1" data-path="creating-a-network.html"><a href="creating-a-network.html#from-survey-to-edgelist"><i class="fa fa-check"></i><b>4.2.1</b> From survey to edgelist</a></li>
<li class="chapter" data-level="4.2.2" data-path="creating-a-network.html"><a href="creating-a-network.html#igraph-network"><i class="fa fa-check"></i><b>4.2.2</b> igraph network</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="network-descriptive-stats.html"><a href="network-descriptive-stats.html"><i class="fa fa-check"></i><b>4.3</b> Network descriptive stats</a></li>
<li class="chapter" data-level="4.4" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html"><i class="fa fa-check"></i><b>4.4</b> Plotting the network in igraph</a><ul>
<li class="chapter" data-level="4.4.1" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html#single-plot"><i class="fa fa-check"></i><b>4.4.1</b> Single plot</a></li>
<li class="chapter" data-level="4.4.2" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html#multiple-plots"><i class="fa fa-check"></i><b>4.4.2</b> Multiple plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="statistical-tests.html"><a href="statistical-tests.html"><i class="fa fa-check"></i><b>4.5</b> Statistical tests</a><ul>
<li class="chapter" data-level="4.5.1" data-path="statistical-tests.html"><a href="statistical-tests.html#is-nomination-number-correlated-with-indegree"><i class="fa fa-check"></i><b>4.5.1</b> Is nomination number correlated with indegree?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exponential-random-graph-models.html"><a href="exponential-random-graph-models.html"><i class="fa fa-check"></i><b>5</b> Exponential Random Graph Models</a><ul>
<li class="chapter" data-level="5.1" data-path="a-naïve-example.html"><a href="a-naïve-example.html"><i class="fa fa-check"></i><b>5.1</b> A naïve example</a></li>
<li class="chapter" data-level="5.2" data-path="estimation-of-ergms.html"><a href="estimation-of-ergms.html"><i class="fa fa-check"></i><b>5.2</b> Estimation of ERGMs</a></li>
<li class="chapter" data-level="5.3" data-path="the-ergm-package.html"><a href="the-ergm-package.html"><i class="fa fa-check"></i><b>5.3</b> The <code>ergm</code> package</a></li>
<li class="chapter" data-level="5.4" data-path="running-ergms.html"><a href="running-ergms.html"><i class="fa fa-check"></i><b>5.4</b> Running ERGMs</a></li>
<li class="chapter" data-level="5.5" data-path="model-goodness-of-fit.html"><a href="model-goodness-of-fit.html"><i class="fa fa-check"></i><b>5.5</b> Model Goodness-of-Fit</a></li>
<li class="chapter" data-level="5.6" data-path="more-on-mcmc-convergence.html"><a href="more-on-mcmc-convergence.html"><i class="fa fa-check"></i><b>5.6</b> More on MCMC convergence</a></li>
<li class="chapter" data-level="5.7" data-path="mathematical-interpretation.html"><a href="mathematical-interpretation.html"><i class="fa fa-check"></i><b>5.7</b> Mathematical Interpretation</a></li>
<li class="chapter" data-level="5.8" data-path="markov-independence.html"><a href="markov-independence.html"><i class="fa fa-check"></i><b>5.8</b> Markov independence</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="using-constraints-in-ergms.html"><a href="using-constraints-in-ergms.html"><i class="fa fa-check"></i><b>6</b> Using constraints in ERGMs</a><ul>
<li class="chapter" data-level="6.1" data-path="example-1-interlocking-egos-and-disconnected-alters.html"><a href="example-1-interlocking-egos-and-disconnected-alters.html"><i class="fa fa-check"></i><b>6.1</b> Example 1: Interlocking egos and disconnected alters</a></li>
<li class="chapter" data-level="6.2" data-path="example-2-bi-partite-networks.html"><a href="example-2-bi-partite-networks.html"><i class="fa fa-check"></i><b>6.2</b> Example 2: Bi-partite networks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="separable-temporal-exponential-family-random-graph-models.html"><a href="separable-temporal-exponential-family-random-graph-models.html"><i class="fa fa-check"></i><b>7</b> (Separable) Temporal Exponential Family Random Graph Models</a></li>
<li class="chapter" data-level="8" data-path="simulating-and-visualizing-networks.html"><a href="simulating-and-visualizing-networks.html"><i class="fa fa-check"></i><b>8</b> Simulating and visualizing networks</a><ul>
<li class="chapter" data-level="8.1" data-path="random-graph-models.html"><a href="random-graph-models.html"><i class="fa fa-check"></i><b>8.1</b> Random Graph Models</a></li>
<li class="chapter" data-level="8.2" data-path="social-networks-in-schools.html"><a href="social-networks-in-schools.html"><i class="fa fa-check"></i><b>8.2</b> Social Networks in Schools</a></li>
<li class="chapter" data-level="8.3" data-path="reading-a-network.html"><a href="reading-a-network.html"><i class="fa fa-check"></i><b>8.3</b> Reading a network</a></li>
<li class="chapter" data-level="8.4" data-path="visualizing-the-network.html"><a href="visualizing-the-network.html"><i class="fa fa-check"></i><b>8.4</b> Visualizing the network</a><ul>
<li class="chapter" data-level="8.4.1" data-path="visualizing-the-network.html"><a href="visualizing-the-network.html#vertex-size"><i class="fa fa-check"></i><b>8.4.1</b> Vertex size</a></li>
<li class="chapter" data-level="8.4.2" data-path="visualizing-the-network.html"><a href="visualizing-the-network.html#vertex-color"><i class="fa fa-check"></i><b>8.4.2</b> Vertex color</a></li>
<li class="chapter" data-level="8.4.3" data-path="visualizing-the-network.html"><a href="visualizing-the-network.html#vertex-shape"><i class="fa fa-check"></i><b>8.4.3</b> Vertex shape</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="hypothesis-testing-in-networks.html"><a href="hypothesis-testing-in-networks.html"><i class="fa fa-check"></i><b>9</b> Hypothesis testing in networks</a><ul>
<li class="chapter" data-level="9.1" data-path="comparing-networks.html"><a href="comparing-networks.html"><i class="fa fa-check"></i><b>9.1</b> Comparing networks</a><ul>
<li class="chapter" data-level="9.1.1" data-path="comparing-networks.html"><a href="comparing-networks.html#network-bootstrap"><i class="fa fa-check"></i><b>9.1.1</b> Network bootstrap</a></li>
<li class="chapter" data-level="9.1.2" data-path="comparing-networks.html"><a href="comparing-networks.html#when-the-statistic-is-normal"><i class="fa fa-check"></i><b>9.1.2</b> When the statistic is normal</a></li>
<li class="chapter" data-level="9.1.3" data-path="comparing-networks.html"><a href="comparing-networks.html#when-the-statistic-is-not-normal"><i class="fa fa-check"></i><b>9.1.3</b> When the statistic is NOT normal</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>9.2</b> Examples</a><ul>
<li class="chapter" data-level="9.2.1" data-path="examples.html"><a href="examples.html#average-of-node-level-stats"><i class="fa fa-check"></i><b>9.2.1</b> Average of node-level stats</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="network-diffussion-with-netdiffuser.html"><a href="network-diffussion-with-netdiffuser.html"><i class="fa fa-check"></i><b>10</b> Network diffussion with <code>netdiffuseR</code></a><ul>
<li class="chapter" data-level="10.1" data-path="network-diffusion-of-innovation.html"><a href="network-diffusion-of-innovation.html"><i class="fa fa-check"></i><b>10.1</b> Network diffusion of innovation</a><ul>
<li class="chapter" data-level="10.1.1" data-path="network-diffusion-of-innovation.html"><a href="network-diffusion-of-innovation.html#diffusion-networks"><i class="fa fa-check"></i><b>10.1.1</b> Diffusion networks</a></li>
<li class="chapter" data-level="10.1.2" data-path="network-diffusion-of-innovation.html"><a href="network-diffusion-of-innovation.html#thresholds"><i class="fa fa-check"></i><b>10.1.2</b> Thresholds</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="the-netdiffuser-r-package.html"><a href="the-netdiffuser-r-package.html"><i class="fa fa-check"></i><b>10.2</b> The netdiffuseR R package</a><ul>
<li class="chapter" data-level="10.2.1" data-path="the-netdiffuser-r-package.html"><a href="the-netdiffuser-r-package.html#overview"><i class="fa fa-check"></i><b>10.2.1</b> Overview</a></li>
<li class="chapter" data-level="10.2.2" data-path="the-netdiffuser-r-package.html"><a href="the-netdiffuser-r-package.html#datasets"><i class="fa fa-check"></i><b>10.2.2</b> Datasets</a></li>
<li class="chapter" data-level="10.2.3" data-path="the-netdiffuser-r-package.html"><a href="the-netdiffuser-r-package.html#visualization-methods"><i class="fa fa-check"></i><b>10.2.3</b> Visualization methods</a></li>
<li class="chapter" data-level="10.2.4" data-path="the-netdiffuser-r-package.html"><a href="the-netdiffuser-r-package.html#problems"><i class="fa fa-check"></i><b>10.2.4</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html"><i class="fa fa-check"></i><b>10.3</b> Simulation of diffusion processes</a><ul>
<li class="chapter" data-level="10.3.1" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#simulating-diffusion-networks"><i class="fa fa-check"></i><b>10.3.1</b> Simulating diffusion networks</a></li>
<li class="chapter" data-level="10.3.2" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#rumor-spreading"><i class="fa fa-check"></i><b>10.3.2</b> Rumor spreading</a></li>
<li class="chapter" data-level="10.3.3" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#difussion"><i class="fa fa-check"></i><b>10.3.3</b> Difussion</a></li>
<li class="chapter" data-level="10.3.4" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#mentor-matching"><i class="fa fa-check"></i><b>10.3.4</b> Mentor Matching</a></li>
<li class="chapter" data-level="10.3.5" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#example-by-changing-threshold"><i class="fa fa-check"></i><b>10.3.5</b> Example by changing threshold</a></li>
<li class="chapter" data-level="10.3.6" data-path="simulation-of-diffusion-processes.html"><a href="simulation-of-diffusion-processes.html#problems-1"><i class="fa fa-check"></i><b>10.3.6</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i><b>10.4</b> Statistical inference</a><ul>
<li class="chapter" data-level="10.4.1" data-path="statistical-inference.html"><a href="statistical-inference.html#morans-i"><i class="fa fa-check"></i><b>10.4.1</b> Moran’s I</a></li>
<li class="chapter" data-level="10.4.2" data-path="statistical-inference.html"><a href="statistical-inference.html#using-geodesics"><i class="fa fa-check"></i><b>10.4.2</b> Using geodesics</a></li>
<li class="chapter" data-level="10.4.3" data-path="statistical-inference.html"><a href="statistical-inference.html#structural-dependence-and-permutation-tests"><i class="fa fa-check"></i><b>10.4.3</b> Structural dependence and permutation tests</a></li>
<li class="chapter" data-level="10.4.4" data-path="statistical-inference.html"><a href="statistical-inference.html#idea"><i class="fa fa-check"></i><b>10.4.4</b> Idea</a></li>
<li class="chapter" data-level="10.4.5" data-path="statistical-inference.html"><a href="statistical-inference.html#regression-analysis"><i class="fa fa-check"></i><b>10.4.5</b> Regression analysis</a></li>
<li class="chapter" data-level="10.4.6" data-path="statistical-inference.html"><a href="statistical-inference.html#problems-2"><i class="fa fa-check"></i><b>10.4.6</b> Problems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="stochastic-actor-oriented-models.html"><a href="stochastic-actor-oriented-models.html"><i class="fa fa-check"></i><b>11</b> Stochastic Actor Oriented Models</a></li>
<li class="chapter" data-level="12" data-path="power-calculation-in-network-studies.html"><a href="power-calculation-in-network-studies.html"><i class="fa fa-check"></i><b>12</b> Power calculation in network studies</a><ul>
<li class="chapter" data-level="12.1" data-path="example-1-spillover-effects-in-egocentric-studiescredit-ego-power.html"><a href="example-1-spillover-effects-in-egocentric-studiescredit-ego-power.html"><i class="fa fa-check"></i><b>12.1</b> Example 1: Spillover effects in egocentric studies</a></li>
<li class="chapter" data-level="12.2" data-path="example-2-spillover-effects-pre-post-effect.html"><a href="example-2-spillover-effects-pre-post-effect.html"><i class="fa fa-check"></i><b>12.2</b> Example 2: Spillover effects pre-post effect</a></li>
<li class="chapter" data-level="12.3" data-path="example-3-first-difference.html"><a href="example-3-first-difference.html"><i class="fa fa-check"></i><b>12.3</b> Example 3: First difference</a></li>
</ul></li>
<li class="part"><span><b>II Statistical Foundations</b></span></li>
<li class="chapter" data-level="13" data-path="bayes-rule.html"><a href="bayes-rule.html"><i class="fa fa-check"></i><b>13</b> Bayes’ Rule</a><ul>
<li class="chapter" data-level="13.1" data-path="metropolis-algorithm.html"><a href="metropolis-algorithm.html"><i class="fa fa-check"></i><b>13.1</b> Metropolis Algorithm</a></li>
<li class="chapter" data-level="13.2" data-path="metropolis-hastings.html"><a href="metropolis-hastings.html"><i class="fa fa-check"></i><b>13.2</b> Metropolis-Hastings</a></li>
<li class="chapter" data-level="13.3" data-path="likelihood-free-mcmc.html"><a href="likelihood-free-mcmc.html"><i class="fa fa-check"></i><b>13.3</b> Likelihood-free MCMC</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="part2-power.html"><a href="part2-power.html"><i class="fa fa-check"></i><b>14</b> Power and sample size</a><ul>
<li class="chapter" data-level="14.1" data-path="error-types.html"><a href="error-types.html"><i class="fa fa-check"></i><b>14.1</b> Error types</a></li>
<li class="chapter" data-level="14.2" data-path="example-1-sample-size-for-a-proportion.html"><a href="example-1-sample-size-for-a-proportion.html"><i class="fa fa-check"></i><b>14.2</b> Example 1: Sample size for a proportion</a></li>
<li class="chapter" data-level="14.3" data-path="example-2-sample-size-for-a-proportion-vis.html"><a href="example-2-sample-size-for-a-proportion-vis.html"><i class="fa fa-check"></i><b>14.3</b> Example 2: Sample size for a proportion (vis)</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="datasets-1.html"><a href="datasets-1.html"><i class="fa fa-check"></i><b>A</b> Datasets</a><ul>
<li class="chapter" data-level="A.1" data-path="sns-data.html"><a href="sns-data.html"><i class="fa fa-check"></i><b>A.1</b> SNS data</a><ul>
<li class="chapter" data-level="A.1.1" data-path="sns-data.html"><a href="sns-data.html#about-the-data"><i class="fa fa-check"></i><b>A.1.1</b> About the data</a></li>
<li class="chapter" data-level="A.1.2" data-path="sns-data.html"><a href="sns-data.html#variables"><i class="fa fa-check"></i><b>A.1.2</b> Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Network Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-3-first-difference" class="section level2 hasAnchor">
<h2><span class="header-section-number">12.3</span> Example 3: First difference<a href="example-3-first-difference.html#example-3-first-difference" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now, instead of looking at a dichotomous outcome, let’s evaluate what happens if
the variable is continuous. The effects we are interested to identify are the ego and alter effect, <span class="math inline">\(\gamma_{ego}\)</span> and <span class="math inline">\(\gamma_{alter}\)</span>, respectively. Furthermore, the data generating process is</p>
<p><span class="math display">\[
\begin{align*}
y_{itg} &amp; = \alpha_i + \kappa_g + X_i\beta + \varepsilon_{itg} \\
y_{itg} &amp; = \alpha_i + \kappa_g + X_i\beta + D_{i}^{ego}\gamma_{ego} + D_i^{alter}\gamma_{alter} + \varepsilon_{itg}
\end{align*}
\]</span></p>
<p>Where <span class="math inline">\(D_i^{ego/alter}\)</span> is an indicator variable. Here, ego and alter behavior are correlated through a fixed effect. In other words,
within each group, we are assuming that there’s a shared baseline prevalence of
the outcome. The main difference is that ego and alter may have different results
regarding the effect size of the treatment. Another way of approaching the group-level
correlation could be through an autocorrelation process, like in a spatial Autocorrelated
model; nonetheless, estimating such models is computationally expensive, so we
opted to use the former.</p>
<p>For simplicity, we assume that there is no time effect. Two essential components here,
<span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\kappa_g\)</span> are individual and group-level unobserved fixed effects.
The most straightforward approach here is to use a first difference estimator:</p>
<p><span class="math display">\[
(y_{it+1g} - y_{itg}) = D_{i}^{ego}\gamma_{ego} + D_i^{alter}\gamma_{alter}  + \varepsilon&#39;_i, \quad \varepsilon&#39;_i = \varepsilon_{it+1g} - \varepsilon_{itg}
\]</span></p>
<p>By taking the first difference, the fixed effects are removed from the equation,
and we can proceed with a regular linear model.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">effect_size_ego   &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb17-2" title="2">effect_size_alter &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb17-3" title="3">sizes &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>)</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># Simulation function</span></a>
<a class="sourceLine" id="cb18-2" title="2">sim_data_prepost &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="co"># Applying attrition</span></a>
<a class="sourceLine" id="cb18-5" title="5">  n &lt;-<span class="st"> </span><span class="kw">floor</span>(n <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>attrition))</a>
<a class="sourceLine" id="cb18-6" title="6"></a>
<a class="sourceLine" id="cb18-7" title="7">  <span class="co"># Step 1: Sampling fixed effects</span></a>
<a class="sourceLine" id="cb18-8" title="8">  alpha_i &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>(n_a <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb18-9" title="9">  kappa_g &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">rnorm</span>(n_a <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), n)</a>
<a class="sourceLine" id="cb18-10" title="10"></a>
<a class="sourceLine" id="cb18-11" title="11">  <span class="co"># Step 2: Generating the outcome at t = 1</span></a>
<a class="sourceLine" id="cb18-12" title="12">  is_ego   &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw">rep</span>(<span class="dv">0</span>, n_a)), n)</a>
<a class="sourceLine" id="cb18-13" title="13">  is_alter &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>is_ego</a>
<a class="sourceLine" id="cb18-14" title="14">  y_<span class="dv">0</span>      &lt;-<span class="st"> </span>alpha_i <span class="op">+</span><span class="st"> </span>kappa_g <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>(n_a <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb18-15" title="15">  y_<span class="dv">1</span>      &lt;-<span class="st"> </span>alpha_i <span class="op">+</span><span class="st"> </span>kappa_g <span class="op">+</span></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="st">    </span>is_ego <span class="op">*</span><span class="st"> </span>effect_size_ego <span class="op">+</span></a>
<a class="sourceLine" id="cb18-17" title="17"><span class="st">    </span>is_alter <span class="op">*</span><span class="st"> </span>effect_size_alter <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-18" title="18"><span class="st">    </span><span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>(n_a <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)) </a>
<a class="sourceLine" id="cb18-19" title="19"></a>
<a class="sourceLine" id="cb18-20" title="20">  <span class="co"># Step 4: Computing test statistic</span></a>
<a class="sourceLine" id="cb18-21" title="21">  res &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb18-22" title="22">    <span class="kw">glm</span>(<span class="kw">I</span>(y_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>y_<span class="dv">0</span>) <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>is_ego <span class="op">+</span><span class="st"> </span>is_alter, <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="st">&quot;identity&quot;</span>)),</a>
<a class="sourceLine" id="cb18-23" title="23">    <span class="dt">error =</span> <span class="cf">function</span>(e) e</a>
<a class="sourceLine" id="cb18-24" title="24">  )</a>
<a class="sourceLine" id="cb18-25" title="25"></a>
<a class="sourceLine" id="cb18-26" title="26">  <span class="cf">if</span> (<span class="kw">inherits</span>(res, <span class="st">&quot;error&quot;</span>))</a>
<a class="sourceLine" id="cb18-27" title="27">    <span class="kw">return</span>(<span class="kw">c</span>(<span class="dt">ego =</span>  <span class="ot">NA</span>, <span class="dt">alter =</span> <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb18-28" title="28">  </a>
<a class="sourceLine" id="cb18-29" title="29">  <span class="co"># Step 5: Reject?</span></a>
<a class="sourceLine" id="cb18-30" title="30">  <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb18-31" title="31">    <span class="co"># ego      = res_ego$p.value &lt; alpha,</span></a>
<a class="sourceLine" id="cb18-32" title="32">    <span class="dt">ego        =</span> <span class="kw">summary</span>(res)<span class="op">$</span>coefficients[<span class="st">&quot;is_ego&quot;</span>, <span class="st">&quot;Pr(&gt;|t|)&quot;</span>] <span class="op">&lt;</span><span class="st"> </span>alpha,</a>
<a class="sourceLine" id="cb18-33" title="33">    <span class="dt">alter      =</span> <span class="kw">summary</span>(res)<span class="op">$</span>coefficients[<span class="st">&quot;is_alter&quot;</span>, <span class="st">&quot;Pr(&gt;|t|)&quot;</span>] <span class="op">&lt;</span><span class="st"> </span>alpha,</a>
<a class="sourceLine" id="cb18-34" title="34">    <span class="kw">coef</span>(res)[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb18-35" title="35">    <span class="kw">coef</span>(res)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb18-36" title="36">  )</a>
<a class="sourceLine" id="cb18-37" title="37">  </a>
<a class="sourceLine" id="cb18-38" title="38"></a>
<a class="sourceLine" id="cb18-39" title="39">}</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># We always set the seed </span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">set.seed</span>(<span class="dv">88</span>)</a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co"># Making space and running!</span></a>
<a class="sourceLine" id="cb19-5" title="5">spower &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="cf">for</span> (s <span class="cf">in</span> sizes) {</a>
<a class="sourceLine" id="cb19-7" title="7"></a>
<a class="sourceLine" id="cb19-8" title="8">  <span class="co"># Run the simulation for size s</span></a>
<a class="sourceLine" id="cb19-9" title="9">  simres &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(</a>
<a class="sourceLine" id="cb19-10" title="10">    <span class="kw">replicate</span>(n_sims, <span class="kw">sim_data_prepost</span>(s)),</a>
<a class="sourceLine" id="cb19-11" title="11">    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb19-12" title="12">    )</a>
<a class="sourceLine" id="cb19-13" title="13"></a>
<a class="sourceLine" id="cb19-14" title="14">  <span class="co"># And store the results</span></a>
<a class="sourceLine" id="cb19-15" title="15">  spower &lt;-<span class="st"> </span><span class="kw">rbind</span>(spower, simres)</a>
<a class="sourceLine" id="cb19-16" title="16"></a>
<a class="sourceLine" id="cb19-17" title="17">}</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb20-2" title="2"></a>
<a class="sourceLine" id="cb20-3" title="3">spowerd &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="kw">data.frame</span>(<span class="dt">size =</span> sizes, <span class="dt">power =</span> spower[,<span class="st">&quot;ego&quot;</span>], <span class="dt">type =</span>  <span class="st">&quot;ego&quot;</span>),</a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="kw">data.frame</span>(<span class="dt">size =</span> sizes, <span class="dt">power =</span> spower[,<span class="st">&quot;alter&quot;</span>], <span class="dt">type =</span>  <span class="st">&quot;alter&quot;</span>)</a>
<a class="sourceLine" id="cb20-6" title="6">)</a>
<a class="sourceLine" id="cb20-7" title="7"></a>
<a class="sourceLine" id="cb20-8" title="8">spowerd <span class="op">|</span><span class="er">&gt;</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> size, <span class="dt">y =</span> power, <span class="dt">colour =</span> type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Egos&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Approx. Power&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;Node type&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>beta_pow) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb20-15" title="15">    <span class="dt">caption =</span> <span class="kw">sprintf</span>(</a>
<a class="sourceLine" id="cb20-16" title="16">      <span class="st">&quot;Ego effect: %.2f; Alter effect: %.2f&quot;</span>, effect_size_ego, effect_size_alter)</a>
<a class="sourceLine" id="cb20-17" title="17">      )</a></code></pre></div>
<p><img src="part-01-10-power_files/figure-html/part-01-power-plot3-1.png" width="672" /></p>
<p>From the inferential point of view, we could still use a demean operator to estimate
individual-level effects. In particular, we would require to use the demean operator at the group level and then fit a fixed effect model to estimate individual-level parameters.</p>
<!-- 

## Example 4: Autocorrelated behavior

In this scenario, ego and alter behavior are correlated. To model this, we will
use a Spatial Autocorrelation Model [SAR.] SAR models are common in Spatial
statistics. A general form is:

$$
\mathbf{y} = \rho W \mathbf{y} + \mathbf{X} \beta + \varepsilon,\quad \varepsilon \sim \mbox{MVN}(0, \sigma^2 I_n),
$$

\noindent where $\rho$ is the correlation coefficient, $W$ is a row-stochastic 
a square matrix and $\varepsilon$ is Multivariate Normal distributed. A row-stochastic
matrix is one where the rows add up to one. In social network analysis, $W$ is usually
operationalized as the inverse of the geodesic matrix, thus, the closer two
individuals are, the higher the influence they have over each other. In our case,
such a system can be simulated using the following equation:

$$
\mathbf{y} = (I_n - \rho W)^{-1}\mathbf{X} \beta + (I_n - \rho W)^{-1}\varepsilon
$$


```r
# Creating a social network. Assuming full connection,
# We can use this as a baseline
library(Matrix)
n <- 500
N <- n * (n_a + 1)
G <- matrix(1, n_a + 1, n_a + 1)
diag(G) <- 0
G <- as(G, "dgCMatrix")

G <- kronecker(
  as(diag(n), "dgCMatrix"), G)

G <- G / rowSums(G)

# set.seed(44)
Sig     <- 1
epsilon <- rnorm(N, sd = Sig)

rho <- 2
I_n <- as(matrix(0, N, N), "dgCMatrix")
diag(I_n) <- 1
y <- solve(I_n - rho * G) %*% epsilon |> as.vector()
```


```r
library(spatialreg)
ans <- lagsarlm(
  res ~ 1,
  listw = spdep::mat2listw(G),
  data = data.frame(res = y)
  )
```

 -->

</div>
<!-- </div> -->



            </section>

          </div>
        </div>
      </div>
<a href="example-2-spillover-effects-pre-post-effect.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayes-rule.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gvegayon/appliedsnar/edit/master/part-01-10-power.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/gvegayon/appliedsnar/blob/master/part-01-10-power.Rmd",
"text": null
},
"download": ["appliedsnar.pdf", "appliedsnar.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
