<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Applied SNA with R</title>
  <meta name="description" content="An improvised book on applied Social Network Analysis with R, this is(will be) a compilation of the materials presented in this series of workshop hosted by USC’s Center for Applied Network Analysis (CANA)">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Applied SNA with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An improvised book on applied Social Network Analysis with R, this is(will be) a compilation of the materials presented in this series of workshop hosted by USC’s Center for Applied Network Analysis (CANA)" />
  <meta name="github-repo" content="gvegayon/appliedsnar" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Applied SNA with R" />
  
  <meta name="twitter:description" content="An improvised book on applied Social Network Analysis with R, this is(will be) a compilation of the materials presented in this series of workshop hosted by USC’s Center for Applied Network Analysis (CANA)" />
  

<meta name="author" content="George G. Vega Yon">


<meta name="date" content="2018-04-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="running-ergms.html">
<link rel="next" href="more-on-mcmc-convergence.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-40608305-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-40608305-4');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied SNA with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this book</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>3</b> R Basics</a><ul>
<li class="chapter" data-level="3.1" data-path="what-is-r.html"><a href="what-is-r.html"><i class="fa fa-check"></i><b>3.1</b> What is R</a></li>
<li class="chapter" data-level="3.2" data-path="how-to-install-packages.html"><a href="how-to-install-packages.html"><i class="fa fa-check"></i><b>3.2</b> How to install packages</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="network-nomination-data.html"><a href="network-nomination-data.html"><i class="fa fa-check"></i><b>4</b> Network Nomination Data</a><ul>
<li class="chapter" data-level="4.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html"><i class="fa fa-check"></i><b>4.1</b> Data preprocessing</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data-preprocessing.html"><a href="data-preprocessing.html#reading-the-data-into-r"><i class="fa fa-check"></i><b>4.1.1</b> Reading the data into R</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-preprocessing.html"><a href="data-preprocessing.html#creating-a-unique-id-for-each-participant"><i class="fa fa-check"></i><b>4.1.2</b> Creating a unique id for each participant</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="creating-a-network.html"><a href="creating-a-network.html"><i class="fa fa-check"></i><b>4.2</b> Creating a network</a><ul>
<li class="chapter" data-level="4.2.1" data-path="creating-a-network.html"><a href="creating-a-network.html#from-survey-to-edgelist"><i class="fa fa-check"></i><b>4.2.1</b> From survey to edgelist</a></li>
<li class="chapter" data-level="4.2.2" data-path="creating-a-network.html"><a href="creating-a-network.html#igraph-network"><i class="fa fa-check"></i><b>4.2.2</b> igraph network</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="network-descriptive-stats.html"><a href="network-descriptive-stats.html"><i class="fa fa-check"></i><b>4.3</b> Network descriptive stats</a></li>
<li class="chapter" data-level="4.4" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html"><i class="fa fa-check"></i><b>4.4</b> Plotting the network in igraph</a><ul>
<li class="chapter" data-level="4.4.1" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html#single-plot"><i class="fa fa-check"></i><b>4.4.1</b> Single plot</a></li>
<li class="chapter" data-level="4.4.2" data-path="plotting-the-network-in-igraph.html"><a href="plotting-the-network-in-igraph.html#multiple-plots"><i class="fa fa-check"></i><b>4.4.2</b> Multiple plots</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="statistical-tests.html"><a href="statistical-tests.html"><i class="fa fa-check"></i><b>4.5</b> Statistical tests</a><ul>
<li class="chapter" data-level="4.5.1" data-path="statistical-tests.html"><a href="statistical-tests.html#is-nomination-number-correlated-with-indegree"><i class="fa fa-check"></i><b>4.5.1</b> Is nomination number correlated with indegree?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exponential-random-graph-models.html"><a href="exponential-random-graph-models.html"><i class="fa fa-check"></i><b>5</b> Exponential Random Graph Models</a><ul>
<li class="chapter" data-level="5.0.1" data-path="exponential-random-graph-models.html"><a href="exponential-random-graph-models.html#a-naive-example"><i class="fa fa-check"></i><b>5.0.1</b> A naive example</a></li>
<li class="chapter" data-level="5.1" data-path="estimation-of-ergms.html"><a href="estimation-of-ergms.html"><i class="fa fa-check"></i><b>5.1</b> Estimation of ERGMs</a></li>
<li class="chapter" data-level="5.2" data-path="the-ergm-package.html"><a href="the-ergm-package.html"><i class="fa fa-check"></i><b>5.2</b> The <code>ergm</code> package</a></li>
<li class="chapter" data-level="5.3" data-path="running-ergms.html"><a href="running-ergms.html"><i class="fa fa-check"></i><b>5.3</b> Running ERGMs</a></li>
<li class="chapter" data-level="5.4" data-path="model-goodness-of-fit.html"><a href="model-goodness-of-fit.html"><i class="fa fa-check"></i><b>5.4</b> Model Goodness-of-Fit</a></li>
<li class="chapter" data-level="5.5" data-path="more-on-mcmc-convergence.html"><a href="more-on-mcmc-convergence.html"><i class="fa fa-check"></i><b>5.5</b> More on MCMC convergence</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="separable-temporal-exponential-family-random-graph-models.html"><a href="separable-temporal-exponential-family-random-graph-models.html"><i class="fa fa-check"></i><b>6</b> (Separable) Temporal Exponential Family Random Graph Models</a></li>
<li class="chapter" data-level="7" data-path="stochastic-actor-oriented-models.html"><a href="stochastic-actor-oriented-models.html"><i class="fa fa-check"></i><b>7</b> Stochastic Actor Oriented Models</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="datasets.html"><a href="datasets.html"><i class="fa fa-check"></i><b>A</b> Datasets</a><ul>
<li class="chapter" data-level="A.1" data-path="sns-data.html"><a href="sns-data.html"><i class="fa fa-check"></i><b>A.1</b> SNS data</a><ul>
<li class="chapter" data-level="A.1.1" data-path="sns-data.html"><a href="sns-data.html#about-the-data"><i class="fa fa-check"></i><b>A.1.1</b> About the data</a></li>
<li class="chapter" data-level="A.1.2" data-path="sns-data.html"><a href="sns-data.html#variables"><i class="fa fa-check"></i><b>A.1.2</b> Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied SNA with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-goodness-of-fit" class="section level2">
<h2><span class="header-section-number">5.4</span> Model Goodness-of-Fit</h2>
<p>In raw terms, once each chain has reach stationary distribution, we can say that there are no problems with autocorrelation and that each sample point is iid. This implies that, since we are running the model with more than 1 chain, we can use all the samples (chains) as a single dataset.</p>
<blockquote>
<p>Recent changes in the ergm estimation algorithm mean that these plots can no longer be used to ensure that the mean statistics from the model match the observed network statistics. For that functionality, please use the GOF command: gof(object, GOF=~model).</p>
<p>—?ergm::mcmc.diagnostics</p>
</blockquote>
<p>Since <code>ans0</code> is the one model which did best, let’s take a look at it’s GOF statistics. First, lets see how the MCMC did. For this we can use the <code>mcmc.diagnostics</code> function including in the package. This function is actually a wrapper of a couple of functions from the <code>coda</code> package <span class="citation">(Plummer et al. <a href="#ref-R-coda">2006</a>)</span> which is called upon the <code>$sample</code> object which holds the <em>centered</em> statistics from the sampled networks. This last point is important to consider since at first look it can be confusing to look at the <code>$sample</code> object since it neither matches the observed statistics, nor the coefficients.</p>
<p>When calling the function <code>mcmc.diagnostics(ans0, centered = FALSE)</code>, you will see a lot of output including a couple of plots showing the trace and posterior distribution of the <em>uncentered</em> statistics (<code>centered = FALSE</code>). In the next code chunks we will reproduce the output from the <code>mcmc.diagnostics</code> function step by step using the coda package. First we need to <em>uncenter</em> the sample object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Getting the centered sample</span>
sample_centered &lt;-<span class="st"> </span>ans0<span class="op">$</span>sample

<span class="co"># Getting the observed statistics and turning it into a matrix so we can add it</span>
<span class="co"># to the samples</span>
observed &lt;-<span class="st"> </span><span class="kw">summary</span>(ans0<span class="op">$</span>formula)
observed &lt;-<span class="st"> </span><span class="kw">matrix</span>(
  observed,
  <span class="dt">nrow  =</span> <span class="kw">nrow</span>(sample_centered[[<span class="dv">1</span>]]),
  <span class="dt">ncol  =</span> <span class="kw">length</span>(observed),
  <span class="dt">byrow =</span> <span class="ot">TRUE</span>
  )

<span class="co"># Now we uncenter the sample</span>
sample_uncentered &lt;-<span class="st"> </span><span class="kw">lapply</span>(sample_centered, <span class="cf">function</span>(x) {
  x <span class="op">+</span><span class="st"> </span>observed
})

<span class="co"># We have to make it an mcmc.list object</span>
sample_uncentered &lt;-<span class="st"> </span>coda<span class="op">::</span><span class="kw">mcmc.list</span>(sample_uncentered)</code></pre></div>
<p>This is what is called under the hood:</p>
<ol style="list-style-type: decimal">
<li><p><em>Empirical means and sd, and quantiles</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(sample_uncentered)</code></pre></div>
<pre><code>## 
## Iterations = 16384:1063936
## Thinning interval = 1024 
## Number of chains = 4 
## Sample size per chain = 1024 
## 
## 1. Empirical mean and standard deviation for each variable,
##    plus standard error of the mean:
## 
##                      Mean    SD Naive SE Time-series SE
## edges              2442.7 51.14   0.7990          3.557
## nodematch.hispanic 1588.2 39.08   0.6106          2.879
## nodematch.female1  1786.0 44.92   0.7018          3.678
## nodematch.eversmk1 1707.0 45.59   0.7123          3.420
## mutual              471.6 20.47   0.3199          3.120
## 
## 2. Quantiles for each variable:
## 
##                    2.5%  25%  50%  75% 97.5%
## edges              2347 2407 2440 2476  2550
## nodematch.hispanic 1515 1561 1588 1613  1668
## nodematch.female1  1699 1755 1785 1816  1879
## nodematch.eversmk1 1622 1675 1705 1739  1797
## mutual              431  459  470  485   515</code></pre></li>
<li><p><em>Cross correlation</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coda<span class="op">::</span><span class="kw">crosscorr</span>(sample_uncentered)</code></pre></div>
<pre><code>##                        edges nodematch.hispanic nodematch.female1
## edges              1.0000000          0.7842851         0.8454275
## nodematch.hispanic 0.7842851          1.0000000         0.6875136
## nodematch.female1  0.8454275          0.6875136         1.0000000
## nodematch.eversmk1 0.8278077          0.6009145         0.6802329
## mutual             0.6761018          0.5362456         0.6581912
##                    nodematch.eversmk1    mutual
## edges                       0.8278077 0.6761018
## nodematch.hispanic          0.6009145 0.5362456
## nodematch.female1           0.6802329 0.6581912
## nodematch.eversmk1          1.0000000 0.6111560
## mutual                      0.6111560 1.0000000</code></pre></li>
<li><p><em>Autocorrelation</em>: Just for now, we will only take a look at autocorrelation for chain 1 only. Autocorrelation should be rather low (in a general MCMC setting). If autocorrelation is high, then it means that your sample is not idd (no markov property). A way out to solve this is <em>thinning</em> the sample.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coda<span class="op">::</span><span class="kw">autocorr</span>(sample_uncentered)[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## , , edges
## 
##               edges nodematch.hispanic nodematch.female1
## Lag 0     1.0000000          0.8219687         0.8705328
## Lag 1024  0.8897580          0.7344981         0.7849176
## Lag 5120  0.6125344          0.5093458         0.5843733
## Lag 10240 0.4944537          0.4263616         0.5010519
## Lag 51200 0.2553223          0.2028499         0.2945153
##           nodematch.eversmk1    mutual
## Lag 0              0.8679762 0.6494130
## Lag 1024           0.7854503 0.6389852
## Lag 5120           0.5671411 0.5952745
## Lag 10240          0.4775676 0.5432361
## Lag 51200          0.2399202 0.3539473
## 
## , , nodematch.hispanic
## 
##               edges nodematch.hispanic nodematch.female1
## Lag 0     0.8219687          1.0000000         0.7213715
## Lag 1024  0.7273184          0.8790036         0.6501736
## Lag 5120  0.4679330          0.5328138         0.4685746
## Lag 10240 0.3548131          0.3719475         0.3735284
## Lag 51200 0.2275837          0.2027639         0.2450665
##           nodematch.eversmk1    mutual
## Lag 0              0.6933735 0.5332499
## Lag 1024           0.6242548 0.5214353
## Lag 5120           0.4278511 0.4686949
## Lag 10240          0.3486120 0.4199291
## Lag 51200          0.2193803 0.2047705
## 
## , , nodematch.female1
## 
##               edges nodematch.hispanic nodematch.female1
## Lag 0     0.8705328          0.7213715         1.0000000
## Lag 1024  0.7882288          0.6530082         0.9067042
## Lag 5120  0.5848867          0.4701031         0.6960912
## Lag 10240 0.5143759          0.4415248         0.6162009
## Lag 51200 0.2943576          0.2717081         0.3756573
##           nodematch.eversmk1    mutual
## Lag 0              0.7737254 0.6670677
## Lag 1024           0.7116355 0.6624944
## Lag 5120           0.5435839 0.6422426
## Lag 10240          0.4804301 0.6076076
## Lag 51200          0.2807997 0.3770320
## 
## , , nodematch.eversmk1
## 
##               edges nodematch.hispanic nodematch.female1
## Lag 0     0.8679762          0.6933735         0.7737254
## Lag 1024  0.7848037          0.6274016         0.7117444
## Lag 5120  0.5581929          0.4628434         0.5535105
## Lag 10240 0.4779814          0.3987335         0.4923237
## Lag 51200 0.2846086          0.2285842         0.3260756
##           nodematch.eversmk1    mutual
## Lag 0              1.0000000 0.5893853
## Lag 1024           0.9073188 0.5852995
## Lag 5120           0.6557095 0.5659845
## Lag 10240          0.5476628 0.5493667
## Lag 51200          0.2846972 0.4000402
## 
## , , mutual
## 
##               edges nodematch.hispanic nodematch.female1
## Lag 0     0.6494130          0.5332499         0.6670677
## Lag 1024  0.6513036          0.5378887         0.6639583
## Lag 5120  0.6380464          0.5446367         0.6412776
## Lag 10240 0.6214549          0.5353477         0.6214122
## Lag 51200 0.3647324          0.2297713         0.4240353
##           nodematch.eversmk1    mutual
## Lag 0              0.5893853 1.0000000
## Lag 1024           0.5878446 0.9884291
## Lag 5120           0.5696277 0.9396082
## Lag 10240          0.5458346 0.8806506
## Lag 51200          0.2897837 0.3673476</code></pre></li>
<li><p><em>Geweke Diagnostic</em>: From the function’s help file:</p>
<blockquote>
<p>“If the samples are drawn from the stationary distribution of the chain, the two means are equal and Geweke’s statistic has an asymptotically standard normal distribution. […] The Z-score is calculated under the assumption that the two parts of the chain are asymptotically independent, which requires that the sum of frac1 and frac2 be strictly less than 1.”&quot;</p>
<p>—?coda::geweke.diag</p>
</blockquote>
<p>Let’s take a look at a single chain:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coda<span class="op">::</span><span class="kw">geweke.diag</span>(sample_uncentered)[[<span class="dv">1</span>]]</code></pre></div>
<pre><code>## 
## Fraction in 1st window = 0.1
## Fraction in 2nd window = 0.5 
## 
##              edges nodematch.hispanic  nodematch.female1 
##             1.2158             1.9078             1.0548 
## nodematch.eversmk1             mutual 
##             1.6781             0.4969</code></pre></li>
<li><p><em>(not included) Gelman Diagnostic</em>: From the function’s help file:</p>
<blockquote>
<p>Gelman and Rubin (1992) propose a general approach to monitoring convergence of MCMC output in which m &gt; 1 parallel chains are run with starting values that are overdispersed relative to the posterior distribution. Convergence is diagnosed when the chains have ‘forgotten’ their initial values, and the output from all chains is indistinguishable. The gelman.diag diagnostic is applied to a single variable from the chain. It is based a comparison of within-chain and between-chain variances, and is similar to a classical analysis of variance. —?coda::gelman.diag</p>
</blockquote>
<p>As a difference from the previous diagnostic statistic, this uses all chains simulatenously:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coda<span class="op">::</span><span class="kw">gelman.diag</span>(sample_uncentered)</code></pre></div>
<pre><code>## Potential scale reduction factors:
## 
##                    Point est. Upper C.I.
## edges                    1.23       1.60
## nodematch.hispanic       1.13       1.36
## nodematch.female1        1.13       1.35
## nodematch.eversmk1       1.21       1.58
## mutual                   1.42       2.08
## 
## Multivariate psrf
## 
## 1.41</code></pre>
<p>As a rule of thumb, values that are in the <span class="math inline">\([.9,1.1]\)</span> are good.</p></li>
</ol>
<p>One nice feature of the <code>mcmc.diagnostics</code> function is the nice trace and posterior distribution plots that it generates. If you have the R package <code>latticeExtra</code> <span class="citation">(Sarkar and Andrews <a href="#ref-R-latticeExtra">2016</a>)</span>, the function will override the default plots used by <code>coda::plot.mcmc</code> and use lattice instead, creating a nicer looking plots. The next code chunk calls the <code>mcmc.diagnostic</code> function, but we suppress the rest of the output (see figure <a href="model-goodness-of-fit.html#fig:coda-plots">5.1</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mcmc.diagnostics</span>(ans0, <span class="dt">center =</span> <span class="ot">FALSE</span>) <span class="co"># Suppressing all the output</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:coda-plots"></span>
<img src="appliedsnar_files/figure-html/coda-plots-1.png" alt="Trace and posterior distribution of sampled network statistics." width="672" />
<p class="caption">
Figure 5.1: Trace and posterior distribution of sampled network statistics.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:coda-plots"></span>
<img src="appliedsnar_files/figure-html/coda-plots-2.png" alt="Trace and posterior distribution of sampled network statistics (cont'd)." width="672" />
<p class="caption">
Figure 5.1: Trace and posterior distribution of sampled network statistics (cont’d).
</p>
</div>
<p>If we called the function <code>mcmc.diagnostics</code> this message appears at the end:</p>
<blockquote>
<p>MCMC diagnostics shown here are from the last round of simulation, prior to computation of final parameter estimates. Because the final estimates are refinements of those used for this simulation run, these diagnostics may understate model performance. To directly assess the performance of the final model on in-model statistics, please use the GOF command: gof(ergmFitObject, GOF=~model).</p>
<p>—<code>mcmc.diagnostics(ans0)</code></p>
</blockquote>
<p>Not that bad (although the <code>mutual</code> term could do better)!<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a> First, observe that in the plot we see 4 different lines, why is that? Well, since we were running in parallel using 4 cores the algorithm actually ran 4 different chains of the MCMC algorithm. An eyeball test is to see if all the chains moved at about the same place, if we have that we can start thinking about model convergence from the mcmc perspective.</p>
<p>Once we are sure to have reach convergence on the MCMC algorithm, we can start thinking about how well does our model predicts the observed network’s proterties. Besides of the statistics that define our ERGM, the <code>gof</code> function’s default behavior show GOF for:</p>
<ol style="list-style-type: lower-alpha">
<li>In degree distribution,</li>
<li>Out degree distribution,</li>
<li>Edge-wise shared partners, and</li>
<li>Geodesics</li>
</ol>
<p>Let’s take a look at it</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Computing and printing GOF estatistics</span>
ans_gof &lt;-<span class="st"> </span><span class="kw">gof</span>(ans0)
ans_gof</code></pre></div>
<pre><code>## 
## Goodness-of-fit for in-degree 
## 
##    obs min  mean max MC p-value
## 0   13   0  1.87   6       0.00
## 1   34   2  8.25  18       0.00
## 2   37  11 21.50  31       0.00
## 3   48  27 39.39  52       0.16
## 4   37  38 55.15  78       0.00
## 5   47  47 62.90  84       0.02
## 6   42  47 63.23  85       0.00
## 7   39  40 53.80  70       0.00
## 8   35  25 41.40  59       0.30
## 9   21  17 29.61  41       0.08
## 10  12   8 18.62  28       0.24
## 11  19   4 10.80  19       0.02
## 12   4   2  6.18  12       0.62
## 13   7   0  3.14   9       0.16
## 14   6   0  1.23   5       0.00
## 15   3   0  0.50   2       0.00
## 16   4   0  0.32   3       0.00
## 17   3   0  0.10   2       0.00
## 18   3   0  0.00   0       0.00
## 19   2   0  0.01   1       0.00
## 20   1   0  0.00   0       0.00
## 22   1   0  0.00   0       0.00
## 
## Goodness-of-fit for out-degree 
## 
##    obs min  mean max MC p-value
## 0    4   0  1.73   5       0.18
## 1   28   1  8.93  16       0.00
## 2   45  13 20.98  34       0.00
## 3   50  27 39.60  54       0.12
## 4   54  38 55.06  69       0.94
## 5   62  46 62.52  78       0.98
## 6   40  50 62.49  81       0.00
## 7   28  37 54.67  72       0.00
## 8   13  31 42.24  54       0.00
## 9   16  16 28.97  41       0.02
## 10  20   6 18.74  28       0.82
## 11   8   5 10.71  17       0.50
## 12  11   1  6.09  12       0.10
## 13  13   0  2.78   7       0.00
## 14   6   0  1.48   6       0.02
## 15   6   0  0.57   3       0.00
## 16   7   0  0.23   2       0.00
## 17   4   0  0.10   1       0.00
## 18   3   0  0.08   1       0.00
## 19   0   0  0.03   1       1.00
## 
## Goodness-of-fit for edgewise shared partner 
## 
##       obs  min    mean  max MC p-value
## esp0 1032 1996 2252.28 2357          0
## esp1  755  165  241.97  407          0
## esp2  352    6   14.98   81          0
## esp3  202    0    0.66   15          0
## esp4   79    0    0.01    1          0
## esp5   36    0    0.00    0          0
## esp6   14    0    0.00    0          0
## esp7    4    0    0.00    0          0
## esp8    1    0    0.00    0          0
## 
## Goodness-of-fit for minimum geodesic distance 
## 
##       obs   min     mean   max MC p-value
## 1    2475  2374  2509.90  2667       0.58
## 2   10672 12763 14421.15 16321       0.00
## 3   31134 51730 58783.98 66543       0.00
## 4   50673 75774 78515.61 81865       0.00
## 5   42563 11964 17516.75 24191       0.00
## 6   18719   303   968.19  1928       0.00
## 7    4808     0    32.79   346       0.00
## 8     822     0     1.50    48       0.00
## 9     100     0     0.08     4       0.00
## 10      7     0     0.00     0       0.00
## Inf 12333     0  1556.05  3322       0.00
## 
## Goodness-of-fit for model statistics 
## 
##                     obs  min    mean  max MC p-value
## edges              2475 2374 2509.90 2667       0.58
## nodematch.hispanic 1615 1545 1641.50 1757       0.64
## nodematch.female1  1814 1710 1837.83 1927       0.56
## nodematch.eversmk1 1738 1653 1758.92 1849       0.74
## mutual              486  449  496.92  542       0.74</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plotting GOF statistics</span>
<span class="kw">plot</span>(ans_gof)</code></pre></div>
<p><img src="appliedsnar_files/figure-html/checking-gof-1.png" width="672" /><img src="appliedsnar_files/figure-html/checking-gof-2.png" width="672" /><img src="appliedsnar_files/figure-html/checking-gof-3.png" width="672" /><img src="appliedsnar_files/figure-html/checking-gof-4.png" width="672" /><img src="appliedsnar_files/figure-html/checking-gof-5.png" width="672" /></p>
<p>Try the following configuration instead</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans0_bis &lt;-<span class="st"> </span><span class="kw">ergm</span>(
  network_<span class="dv">111</span> <span class="op">~</span>
<span class="st">    </span>edges <span class="op">+</span>
<span class="st">    </span><span class="kw">nodematch</span>(<span class="st">&quot;hispanic&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">nodematch</span>(<span class="st">&quot;female1&quot;</span>) <span class="op">+</span>
<span class="st">    </span>mutual <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">esp</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">idegree</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)
    ,
  <span class="dt">constraints =</span> <span class="op">~</span><span class="kw">bd</span>(<span class="dt">maxout =</span> <span class="dv">19</span>),
  <span class="dt">control =</span> <span class="kw">control.ergm</span>(
    <span class="dt">seed        =</span> <span class="dv">1</span>,
    <span class="dt">MCMLE.maxit =</span> <span class="dv">15</span>,
    <span class="dt">parallel    =</span> <span class="dv">4</span>,
    <span class="dt">CD.maxit    =</span> <span class="dv">15</span>,
    <span class="dt">MCMC.samplesize =</span> <span class="dv">2048</span><span class="op">*</span><span class="dv">4</span>,
    <span class="dt">MCMC.burnin =</span> <span class="dv">30000</span>,
    <span class="dt">MCMC.interval =</span> <span class="dv">2048</span><span class="op">*</span><span class="dv">4</span>
    )
  )</code></pre></div>
<p>Increase the sample size so the curves are more smooth, longer intervals (thinning) so we reduce the autocorrelation, larger burin. All this together to improve the Gelman test statistic. We also added idegree from 0 to 10, and esp from 0 to 3 to explicitly match those statistics in our model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;awful-chains.png&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:badconvergence"></span>
<img src="awful-chains.png" alt="An example of a terrible ERGM (no convergence at all). Also, a good example of why running multiple chains can be useful" width="357" />
<p class="caption">
Figure 5.2: An example of a terrible ERGM (no convergence at all). Also, a good example of why running multiple chains can be useful
</p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-coda">
<p>Plummer, Martyn, Nicky Best, Kate Cowles, and Karen Vines. 2006. “CODA: Convergence Diagnosis and Output Analysis for Mcmc.” <em>R News</em> 6 (1): 7–11. <a href="https://journal.r-project.org/archive/" class="uri">https://journal.r-project.org/archive/</a>.</p>
</div>
<div id="ref-R-latticeExtra">
<p>Sarkar, Deepayan, and Felix Andrews. 2016. <em>LatticeExtra: Extra Graphical Utilities Based on Lattice</em>. <a href="https://CRAN.R-project.org/package=latticeExtra" class="uri">https://CRAN.R-project.org/package=latticeExtra</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>The statnet wiki website as a very nice example of (very) bad and good mcmc diagnostics plots <a href="https://statnet.org/trac/raw-attachment/wiki/Resources/ergm.fit.diagnostics.pdf">here</a>.<a href="model-goodness-of-fit.html#fnref10">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="running-ergms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="more-on-mcmc-convergence.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["appliedsnar.pdf", "appliedsnar.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
